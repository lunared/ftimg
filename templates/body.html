<!DOCTYPE html>
<html>
    <head>
        <title>FTIMG - {{path or '/'}}</title>
        <meta name=viewport content="width=device-width, initial-scale=1">
        <style>
            @keyframes marquee {
                0%, 20%   { transform: translate(0%, 0); }
                85%  { transform: translate(-100%, 0); }
                86%  { transform: translate(-100%, 100%);}
                87%, 95%  { transform: translate(-0%, 100%);}
                100% { transform: translate(0%, 0); }
            }

            html, body {
                padding: 0;
                margin: 0;
                background: black;
                color: white;
                font-family: monospace;
            }

            a {
                color: white;
            }

            body.lock {
                overflow: hidden;
            }

            .container {
                width: 100%;
                max-width: 960px;
                margin: auto;
                box-sizing: border-box;
                padding: 0.83em;
                margin-top: 40px;
            }

            .footer {
              margin-right: 2px;
            }

            .pull-right {
                float: right;
            }

            #controls a {
              color: white;
              text-decoration: none;
            }

            #controls a.active {
                text-decoration: underline;
            }

            .clickable:hover {
              cursor: pointer;
            }

            /**
             * Info block
             */
            .info {
                
            }

            .info .tag {

            }

            .info .thumbnail {
                display: inline-block;
                width: 250px;
                margin-right: 10px;
            }

            .info .meta {
                display: inline-block;
                width: calc(100% - 270px);
                vertical-align: top;
                line-height: 1.7em;
            }

            .info .meta br {
                line-height: .5rem;
                display: block;
            }

            .info .meta label {
                font-weight: bold;
            }

            /**
             * Gallery block
             */
             .gallery {
                width: 100%;
             }

             .gallery td {
                 text-align: center;
             }

             .gallery a:hover {
                cursor: pointer;
             }

             /**
              * Full-window view of a page in the gallery
              */
             .preview {
                 position: fixed;
                 top: 0;
                 bottom: 0;
                 left: 0;
                 right: 0;
                 text-align: center;
                 overflow: scroll;
                 pointer-events: none;
                 background: rgba(0,0,0,.8);
                 transition: opacity .2s linear;
                 opacity: 0;
                 padding: 2rem;
             }

             .preview.show {
                 pointer-events: fill;
                 opacity: 1;
             }

             .preview img {
                 max-width: 100%;
             }
        </style>

    </head>
    <body>
        <div class="container">
            <div class="info">
                <div class="thumbnail">
                    <img src="{{ gallery.meta.thumbnail }}" width="100%" />
                </div>
                <div class="meta">
                    {% if is_dict(gallery.meta.title) %}
                        <label>Title: </label><span>{{ gallery.meta.title.localized }}</span>
                        <br/>
                        <label>Native Title: </label><span>{{ gallery.meta.title.native }}</span>
                    {% else %}
                        <label>Title: </label><span>{{ gallery.meta.title }}</span>
                    {% endif %}
                    <br/>
                    <label>Artist(s): </label>
                    <span>{{ ', '.join(gallery.meta.artist) }}</span>
                    <br/>
                    <label>Tags: </label>
                    {% for tag in gallery.meta.tags %}
                        <a href="/?search={{tag}}" class="tag">{{ tag }}</a>
                    {% endfor %}
                    <br/>
                    <label>Pages: </label>
                    <span>{{ gallery.total }}</span>
                </div>
            </div>
            <fieldset id="controls">
                <legend>Controls</legend>
                <label>
                    Pagesize
                    {% for ps in [10, 25, 50] %}
                    <a href="{{'{}?page=1&pagesize={}'.format(path, ps)}}"
                        {% if ps == pagesize %}
                            class="active"
                        {% endif %}
                        >{{ ps }}</a>
                    {% endfor %}
                </label>
                <label class="paginator pull-right">
                    <a href="{{'{}?page=1&pagesize={}'.format(path, pagesize)}}"><<</a>
                    <a href="{{'{}?page={}&pagesize={}'.format(path, prevpage, pagesize)}}"><</a>
                    {% for p in range(max(1, page-2), min(page+3, pages+1)) %}
                    <a href="{{'{}?page={}&pagesize={}'.format(path, p, pagesize)}}"
                        {% if p == page %}
                            class="active"
                        {% endif %}
                    >{{p}}</a>
                    {% endfor %}
                    <a href="{{'{}?page={}&pagesize={}'.format(path, nextpage, pagesize)}}">></a>
                    <a href="{{'{}?page={}&pagesize={}'.format(path, pages, pagesize)}}">>></a>
                </label>
            </fieldset>
            <table class="gallery">
                <tbody>
                    {% for i in range(ceil((gallery.images|length) / 5)) %}
                    <tr>
                        {% for image in gallery.images[i*5:min((i+1) * 5, (gallery.images|length))] %}
                        <td>
                            <a onclick="showImage('{{url}}{{image._id}}')">
                                <img src="{{image.thumbnail}}" width="95%" />
                            </a>
                        </td>
                        {% endfor %}
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <h4 class="footer">
                <a href="/">
                    Return to Index
                </a>
                <a href="https://github.com/nhydock/ftimg" class="pull-right">Powered by ftimg</a>
            </h4>
        </div>

        <div id="preview" class="preview" onclick="hidePreview()">
            <div class="overlay"></div>
            <img id="fullPreview" src="" />
        </div>

        <!-- full image previewer/gallery -->
        <script>
            function showImage(url) {
                document.getElementById("fullPreview").src = url;
                document.getElementById("preview").classList.add("show");
                document.getElementsByTagName("body")[0].classList.add("lock");
            }

            function hidePreview() {
                document.getElementById("preview").classList.remove("show");
                document.getElementsByTagName("body")[0].classList.remove("lock");
            }
        </script>
    </body>
</html>
